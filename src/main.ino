#include <arduino.h>
#include "digitalFilter.h"
#define NUMTHREADS 1 //Deve-se sempre declarar o NUMTHREADS antes de "inindThread.h"
#include "inindThread.h"

//////////////////////////////Funções das Trheads///////////////////////////////////
#define pinANALOG A5 // Configura o pino de leitura
#define ANALOG_INTERVAL 10 // analog read interval (milliseconds)
#define FILTER_ORDER1 50

unsigned long count = 0;

DigitalFilter filter1;
const double filter_taps1[FILTER_ORDER1] = {
-0.0007150316378057743,
-0.001075338917897092,
-0.0013329812662954755,
-0.00136109127576512,
-0.0009564382146871027,
6.976431785384702e-05,
0.0017549824384968887,
0.003857426474285196,
0.005802952841707283,
0.006758402094187532,
0.005845030543329834,
0.0024546500785393465,
-0.0034163711559911866,
-0.010926425518366829,
-0.01834529199253539,
-0.02326891168469186,
-0.0230833297923932,
-0.015591388949480874,
0.00034580367667801326,
0.02432558659803921,
0.054228782856824864,
0.08643516573654678,
0.11641446450623477,
0.13957803749344821,
0.15220155074973812,
0.15220155074973812,
0.13957803749344824,
0.11641446450623479,
0.08643516573654678,
0.05422878285682488,
0.02432558659803922,
0.0003458036766780133,
-0.015591388949480875,
-0.0230833297923932,
-0.023268911684691865,
-0.01834529199253539,
-0.010926425518366834,
-0.0034163711559911875,
0.002454650078539348,
0.005845030543329836,
0.006758402094187539,
0.005802952841707287,
0.003857426474285196,
0.0017549824384968896,
6.976431785384702e-05,
-0.0009564382146871042,
-0.00136109127576512,
-0.001332981266295477,
-0.001075338917897092,
-0.0007150316378057743
};

void analogReadFunc() // Faz a leitura do sinal Analogico
{
  const int analog_Value = analogRead(pinANALOG) - 512;
  DigitalFilter_put(&filter1, analog_Value);

  count += ANALOG_INTERVAL;
  Serial.print(">amp:");
  Serial.print(count);  
  Serial.print(":");  
  Serial.print(DigitalFilter_get(&filter1));
  Serial.println("§Volts|g");
}

void setup()
{ // Codigo de configuração
  Serial.begin(19200);
  pinMode(pinANALOG, INPUT);
  DigitalFilter_init(&filter1, FILTER_ORDER1, filter_taps1);
  threadSetup(analogReadFunc, ANALOG_INTERVAL); // parametros:funcão,intervalo,funcão,intervalo,...
}

void loop()
{ // Codigo loop
}